DEBUG - 2025-10-05 17:21:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 17:21:17 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 17:21:17 --> No existe formulario - primera vez
INFO - 2025-10-05 17:21:17 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"47","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 17:21:17 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 17:21:17 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"11","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 17:21:17 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 17:21:17 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"","posologia":"","dias":"","administrado":0}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["2"]}}
INFO - 2025-10-05 17:21:17 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 17:21:17 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 17:21:17 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 17:21:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 17:25:34 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 17:25:34 --> No existe formulario - primera vez
DEBUG - 2025-10-05 17:25:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 17:25:34 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 17:25:34 --> No existe formulario - primera vez
INFO - 2025-10-05 17:25:34 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"47","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 17:25:34 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 17:25:34 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"11","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 17:25:34 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 17:25:34 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"","posologia":"","dias":"","administrado":0}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["2"]}}
INFO - 2025-10-05 17:25:34 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 17:25:34 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 17:25:34 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 17:25:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:25:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:27:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 17:28:32 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 17:28:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 17:28:39 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 17:28:39 --> No existe formulario - primera vez
DEBUG - 2025-10-05 17:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 17:28:39 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 17:28:39 --> No existe formulario - primera vez
INFO - 2025-10-05 17:28:39 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"47","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 17:28:39 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 17:28:39 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"11","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 17:28:39 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 17:28:39 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"","posologia":"","dias":"","administrado":0}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["2"]}}
INFO - 2025-10-05 17:28:39 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 17:28:39 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 17:28:39 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 17:28:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:28:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:31:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:34:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:38:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:39:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:40:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:41:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:45:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:47:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:55:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:56:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:57:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:58:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 17:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:00:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:01:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:02:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:03:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:05:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:06:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:07:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:14:39 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:14:39 --> No existe formulario - primera vez
INFO - 2025-10-05 18:14:39 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"48","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 18:14:39 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:14:39 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"12","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":"0","emb_numero_partos":"0","emb_numero_abortos":"0","emb_numero_cesareas":"0","emb_fum":"0000-00-00","emb_afu":"","emb_semanas_gestacion":"0","emb_movimiento_fetal":"","emb_frecuencia_cardiaca_fetal":"","emb_ruptura_menbranas":"","emb_tiempo":"","emb_presentacion":"","emb_sangrado_vaginal":"","emb_contracciones":"","emb_dilatacion":"","emb_borramiento":"","emb_plano":"","emb_pelvis_viable":"","emb_score_mama":"","emb_observaciones":""}
INFO - 2025-10-05 18:14:39 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"0","partos":"0","abortos":"0","cesareas":"0","fum":"0000-00-00","semanas_gestacion":"0","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:14:39 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"0","partos":"0","abortos":"0","cesareas":"0","fum":"0000-00-00","semanas_gestacion":"0","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":0},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":0},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":0}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["2"]}}
INFO - 2025-10-05 18:14:39 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:14:39 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"0","partos":"0","abortos":"0","cesareas":"0","fum":"0000-00-00","semanas_gestacion":"0","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:14:39 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 18:14:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:14:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:15:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:16:43 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:16:43 --> No existe formulario - primera vez
DEBUG - 2025-10-05 18:16:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:16:43 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:16:43 --> No existe formulario - primera vez
INFO - 2025-10-05 18:16:43 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"49","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 18:16:43 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:16:43 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"13","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":"0","emb_numero_partos":"0","emb_numero_abortos":"0","emb_numero_cesareas":"0","emb_fum":"0000-00-00","emb_afu":"","emb_semanas_gestacion":"0","emb_movimiento_fetal":"","emb_frecuencia_cardiaca_fetal":"","emb_ruptura_menbranas":"","emb_tiempo":"","emb_presentacion":"","emb_sangrado_vaginal":"","emb_contracciones":"","emb_dilatacion":"","emb_borramiento":"","emb_plano":"","emb_pelvis_viable":"","emb_score_mama":"","emb_observaciones":""}
INFO - 2025-10-05 18:16:43 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"0","partos":"0","abortos":"0","cesareas":"0","fum":"0000-00-00","semanas_gestacion":"0","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:16:43 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"0","partos":"0","abortos":"0","cesareas":"0","fum":"0000-00-00","semanas_gestacion":"0","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["2"]}}
INFO - 2025-10-05 18:16:43 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:16:43 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"0","partos":"0","abortos":"0","cesareas":"0","fum":"0000-00-00","semanas_gestacion":"0","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:16:43 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 18:16:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:16:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:17:26 --> Verificando acceso médico - ate_codigo: 3, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:17:26 --> No existe formulario - primera vez
INFO - 2025-10-05 18:17:26 --> 🔍 DEBUG CREAR REGISTRO - ate_codigo: 3, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:17:26 --> Creando registro formulario: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","observaciones":"Completado en especialidad - are_codigo: 2 - primera vez","modificaciones_permitidas":3,"modificaciones_usadas":0,"habilitado_por_admin":0}
INFO - 2025-10-05 18:17:26 --> Registro de formulario creado exitosamente - ID: 2
DEBUG - 2025-10-05 18:17:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:17:33 --> Login exitoso - Usuario: administrador, ID: 1, Rol: ADMINISTRADOR
DEBUG - 2025-10-05 18:17:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:17:35 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:17:35 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:17:35 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:17:35 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:17:35 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:17:35 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:17:35 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:17:35 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:17:35 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:17:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:17:40 --> 🔄 Iniciando habilitarModificacion: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:17:40 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 3, seccion: ES
INFO - 2025-10-05 18:17:40 --> Formulario encontrado: SÍ
INFO - 2025-10-05 18:17:40 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":null}
INFO - 2025-10-05 18:17:40 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40"}
INFO - 2025-10-05 18:17:40 --> Formulario actualizado exitosamente
INFO - 2025-10-05 18:17:40 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:17:40 --> Procesando reenvío para sección ES - MANTENIENDO habilitación admin
INFO - 2025-10-05 18:17:40 --> Área de atención actualizada para modificación: OK
INFO - 2025-10-05 18:17:40 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=3 para ES - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 18:17:40 --> Reenvío completado exitosamente
INFO - 2025-10-05 18:17:40 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 18:17:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:17:40 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:17:40 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:17:40 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:17:40 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:17:40 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:17:40 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:17:40 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:17:40 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:17:40 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:17:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:17:49 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:17:49 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:17:40","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:17:49 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 18:17:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:17:49 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:17:49 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:17:40","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:17:49 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:17:49 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"50","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 18:17:49 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:17:49 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"14","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:17:49 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:17:49 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:17:49 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:17:49 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:17:49 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 18:17:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:17:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:18:05 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:18:05 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:18:05 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:18:05 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:18:05 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:18:05 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:18:05 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:18:05 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:18:05 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:18:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:18:36 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:18:36 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:18:36 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:18:36 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:18:36 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:18:36 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:18:36 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:18:36 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:18:36 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:18:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:18:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:19:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:19:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:19:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:19:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:19:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:19:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:19:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:19:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:19:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:19:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:19:35 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:19:35 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:19:35 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:19:35 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:19:35 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:19:35 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:19:35 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:19:35 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:19:35 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:19:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:19:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:20:05 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:20:05 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:20:05 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:20:05 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:20:05 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:20:05 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:20:05 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:20:05 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:20:05 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:20:20 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:20:20 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:17:40","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:20:20 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:20:20 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"50","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 18:20:20 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:20:20 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"14","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:20:20 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:20:20 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:20:20 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:20:20 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:20:20 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 18:20:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:20:30 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:20:30 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:17:40","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:20:30 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:20:30 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"50","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 18:20:30 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:20:30 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"14","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:20:30 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:20:30 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:20:30 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:20:30 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:20:30 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 18:20:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:20:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:20:35 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:20:35 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:20:35 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:20:35 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:20:35 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:20:35 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:20:35 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:20:35 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:20:35 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:21:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:21:05 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:21:05 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:21:05 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:21:05 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:21:05 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:21:05 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:21:05 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:21:05 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:21:05 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:21:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:21:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:21:20 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:21:20 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:17:40","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:21:20 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:21:20 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"50","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 18:21:20 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:21:20 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"14","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:21:20 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:21:20 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:21:20 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:21:20 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:21:20 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 18:21:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:22:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:22:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:22:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:22:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:22:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:22:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:22:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:22:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:22:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:22:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:23:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:23:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:23:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:23:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:23:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:23:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:23:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:23:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:23:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:23:59 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:23:59 --> No existe formulario - primera vez
DEBUG - 2025-10-05 18:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:23:59 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:23:59 --> No existe formulario - primera vez
INFO - 2025-10-05 18:23:59 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"34","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"35","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"36","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"37","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"38","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"39","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"40","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"41","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"42","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"43","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 18:23:59 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 18:23:59 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"7","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:23:59 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:23:59 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["1"]}}
INFO - 2025-10-05 18:23:59 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 18:23:59 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:23:59 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 18:24:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:24:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:24:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:24:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:24:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:24:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:24:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:24:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:24:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:24:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:24:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:24:45 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:24:45 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:24:45 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:24:45 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:24:45 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:24:45 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:24:45 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:24:45 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:24:45 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:25:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:25:05 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:25:05 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:25:05 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:25:05 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:25:05 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:25:05 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:25:05 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:25:05 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:25:05 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:25:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:25:35 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:25:35 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:25:35 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:25:35 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:25:35 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:25:35 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:25:35 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:25:35 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:25:35 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:26:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:26:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:26:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:26:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:26:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:26:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:26:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:26:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:26:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:26:07 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:26:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:26:42 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:26:42 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:26:42 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:26:42 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:26:42 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:26:42 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:26:42 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:26:42 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:26:42 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:26:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:26:59 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:26:59 --> No existe formulario - primera vez
INFO - 2025-10-05 18:26:59 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"34","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"35","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"36","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"37","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"38","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"39","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"40","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"41","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"42","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"43","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 18:26:59 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 18:26:59 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"7","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:26:59 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:26:59 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["1"]}}
INFO - 2025-10-05 18:26:59 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 18:26:59 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:26:59 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 18:27:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:27:05 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:27:05 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:27:05 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:27:05 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:27:05 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:27:05 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:27:05 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:27:05 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:27:05 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:27:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:27:23 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:27:23 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:17:40","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:27:23 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 18:27:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:27:23 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:27:23 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:17:40","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:27:23 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:27:23 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"50","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 18:27:23 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:27:23 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"14","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:27:23 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:27:23 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:27:23 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 18:27:23 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:27:23 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 18:27:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:27:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:27:35 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:27:35 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:27:35 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:27:35 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:27:35 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:27:35 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:27:35 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:27:35 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:27:35 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:28:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:28:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:28:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:28:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:28:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:28:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:28:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:28:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:28:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:28:07 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:17:40","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:28:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:28:10 --> Verificando acceso médico - ate_codigo: 3, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:28:10 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:17:40","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:28:10 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:28:10 --> Registrando modificación usada - ate_codigo: 3, sección: ES
INFO - 2025-10-05 18:28:10 --> Modificación por admin - Estado actual: 0/3, incrementando a: 1
INFO - 2025-10-05 18:28:10 --> Modificación por admin DESHABILITADA después de uso - ate_codigo: 3
INFO - 2025-10-05 18:28:10 --> Modificación registrada: 1/3 - OK
INFO - 2025-10-05 18:28:10 --> 🔒 DESHABILITANDO después de usar: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:28:10 --> Deshabilitando modificación usada para sección ES
INFO - 2025-10-05 18:28:10 --> Habilitación DESACTIVADA después de usar para ES: OK
INFO - 2025-10-05 18:28:10 --> Área de atención marcada como COMPLETADA después de usar modificación
INFO - 2025-10-05 18:28:10 --> ✅ DESHABILITACIÓN EXITOSA: ate_codigo=3 para ES - REMOVIDO DE LISTA
DEBUG - 2025-10-05 18:28:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:28:31 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:28:31 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:28:31 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:28:31 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:28:31 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:28:31 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:28:31 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:28:31 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:28:31 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"1","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:28:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:28:34 --> 🔄 Iniciando habilitarModificacion: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:28:34 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 3, seccion: ES
INFO - 2025-10-05 18:28:34 --> Formulario encontrado: SÍ
INFO - 2025-10-05 18:28:34 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada"}
INFO - 2025-10-05 18:28:34 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:28:34"}
INFO - 2025-10-05 18:28:34 --> Formulario actualizado exitosamente
INFO - 2025-10-05 18:28:34 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:28:34 --> Procesando reenvío para sección ES - MANTENIENDO habilitación admin
INFO - 2025-10-05 18:28:34 --> Área de atención actualizada para modificación: OK
INFO - 2025-10-05 18:28:34 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=3 para ES - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 18:28:34 --> Reenvío completado exitosamente
INFO - 2025-10-05 18:28:34 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 18:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:28:34 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:28:34 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:28:34 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:28:34 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:28:34 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:28:34 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:28:34 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:28:34 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:28:34 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:28:34","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"1","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:28:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:28:35 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:28:35 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:28:35 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:28:35 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:28:35 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:28:35 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:28:35 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:28:35 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:28:35 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:28:34","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"1","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:28:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:28:52 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:28:52 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:28:34","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:28:52 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 18:28:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:28:52 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:28:52 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:28:34","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:28:52 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:28:52 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 18:28:52 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 18:28:52 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 18:28:52 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 18:28:52 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:28:52 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 18:28:52 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 18:28:52 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 18:28:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:28:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:29:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:29:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:29:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:29:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:29:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:29:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:29:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:29:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:29:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 18:28:34","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"1","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:29:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:29:28 --> Verificando acceso médico - ate_codigo: 3, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:29:28 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:28:34","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 18:29:28 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:29:28 --> Registrando modificación usada - ate_codigo: 3, sección: ES
INFO - 2025-10-05 18:29:28 --> Modificación por admin - Estado actual: 1/3, incrementando a: 2
INFO - 2025-10-05 18:29:28 --> Modificación por admin DESHABILITADA después de uso - ate_codigo: 3
INFO - 2025-10-05 18:29:28 --> Modificación registrada: 2/3 - OK
INFO - 2025-10-05 18:29:28 --> 🔒 DESHABILITANDO después de usar: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:29:28 --> Deshabilitando modificación usada para sección ES
INFO - 2025-10-05 18:29:28 --> Habilitación DESACTIVADA después de usar para ES: OK
INFO - 2025-10-05 18:29:28 --> Área de atención marcada como COMPLETADA después de usar modificación
INFO - 2025-10-05 18:29:28 --> ✅ DESHABILITACIÓN EXITOSA: ate_codigo=3 para ES - REMOVIDO DE LISTA
DEBUG - 2025-10-05 18:29:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:29:32 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:29:32 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:29:32 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:29:32 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:29:32 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:29:32 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:29:32 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:29:32 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:29:32 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:29:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:29:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:30:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:30:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:30:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:30:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:30:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:30:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:30:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:30:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:30:48 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:30:52 --> 🔄 Iniciando habilitarModificacion: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:30:52 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 3, seccion: ES
INFO - 2025-10-05 18:30:52 --> Formulario encontrado: SÍ
INFO - 2025-10-05 18:30:52 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada"}
INFO - 2025-10-05 18:30:52 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"asd","fecha_habilitacion":"2025-10-05 18:30:52"}
INFO - 2025-10-05 18:30:52 --> Formulario actualizado exitosamente
INFO - 2025-10-05 18:30:52 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:30:52 --> Procesando reenvío para sección ES - MANTENIENDO habilitación admin
INFO - 2025-10-05 18:30:52 --> Área de atención actualizada para modificación: OK
INFO - 2025-10-05 18:30:52 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=3 para ES - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 18:30:52 --> Reenvío completado exitosamente
INFO - 2025-10-05 18:30:52 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 18:30:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:30:52 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:30:52 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:30:52 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:30:52 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:30:52 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:30:52 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:30:52 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:30:52 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:30:52 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asd","fecha_habilitacion":"2025-10-05 18:30:52","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:31:01 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 18:31:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:31:08 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:31:08 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:30:52","motivo_habilitacion":"asd"}
INFO - 2025-10-05 18:31:08 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 18:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:31:08 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:31:08 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:30:52","motivo_habilitacion":"asd"}
INFO - 2025-10-05 18:31:08 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:31:08 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 18:31:08 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 18:31:08 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 18:31:08 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 18:31:08 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:31:08 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 18:31:08 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 18:31:08 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 18:31:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:31:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:31:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:31:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:31:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:31:19 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:31:19 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:31:19 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:31:19 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:31:19 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asd","fecha_habilitacion":"2025-10-05 18:30:52","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:31:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:31:36 --> Verificando acceso médico - ate_codigo: 3, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:31:36 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:30:52","motivo_habilitacion":"asd"}
INFO - 2025-10-05 18:31:36 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:31:36 --> Registrando modificación usada - ate_codigo: 3, sección: ES
INFO - 2025-10-05 18:31:36 --> Modificación por admin - Estado actual: 2/3, incrementando a: 3
INFO - 2025-10-05 18:31:36 --> Modificación por admin DESHABILITADA después de uso - ate_codigo: 3
INFO - 2025-10-05 18:31:36 --> Modificación registrada: 3/3 - OK
INFO - 2025-10-05 18:31:36 --> 🔒 DESHABILITANDO después de usar: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:31:36 --> Deshabilitando modificación usada para sección ES
INFO - 2025-10-05 18:31:36 --> Habilitación DESACTIVADA después de usar para ES: OK
INFO - 2025-10-05 18:31:36 --> Área de atención marcada como COMPLETADA después de usar modificación
INFO - 2025-10-05 18:31:36 --> ✅ DESHABILITACIÓN EXITOSA: ate_codigo=3 para ES - REMOVIDO DE LISTA
DEBUG - 2025-10-05 18:31:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:31:49 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:31:49 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:31:49 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:31:49 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:31:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:31:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:31:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:31:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:31:49 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"3","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"0","motivo_bloqueo":"L\u00edmite de modificaciones alcanzado (3\/3)","estado_boton_admin":"BLOQUEADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"3","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:31:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:31:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:32:13 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:32:13 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:32:13 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:32:13 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:32:13 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:32:13 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:32:13 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:32:13 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:32:13 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:32:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:32:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:32:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:32:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:32:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:32:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:32:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:32:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:32:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:32:18 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:32:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:32:19 --> 🔄 Iniciando habilitarModificacion: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:32:19 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 3, seccion: ES
INFO - 2025-10-05 18:32:19 --> Formulario encontrado: SÍ
INFO - 2025-10-05 18:32:19 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada"}
INFO - 2025-10-05 18:32:19 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19"}
INFO - 2025-10-05 18:32:19 --> Formulario actualizado exitosamente
INFO - 2025-10-05 18:32:19 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:32:19 --> Procesando reenvío para sección ES - MANTENIENDO habilitación admin
INFO - 2025-10-05 18:32:19 --> Área de atención actualizada para modificación: OK
INFO - 2025-10-05 18:32:19 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=3 para ES - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 18:32:19 --> Reenvío completado exitosamente
INFO - 2025-10-05 18:32:19 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 18:32:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:32:19 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:32:19 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:32:19 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:32:19 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:32:19 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:32:19 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:32:19 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:32:19 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:32:19 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:32:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:32:31 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:32:31 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:32:19","motivo_habilitacion":"asdas"}
INFO - 2025-10-05 18:32:31 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 18:32:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:32:31 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:32:31 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:32:19","motivo_habilitacion":"asdas"}
INFO - 2025-10-05 18:32:31 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:32:31 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 18:32:31 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 18:32:31 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 18:32:31 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 18:32:31 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:32:31 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 18:32:31 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 18:32:31 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:32:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:32:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:32:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:32:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:32:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:32:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:32:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:32:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:32:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:32:49 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:33:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:33:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:33:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:33:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:33:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:33:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:33:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:33:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:33:18 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:33:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:33:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:33:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:33:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:33:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:33:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:33:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:33:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:33:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:33:48 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:33:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:34:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:34:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:34:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:34:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:34:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:34:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:34:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:34:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:34:18 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:34:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:34:56 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 18:34:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:34:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:35:02 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:35:02 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:32:19","motivo_habilitacion":"asdas"}
INFO - 2025-10-05 18:35:02 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 18:35:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:35:02 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:35:02 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:32:19","motivo_habilitacion":"asdas"}
INFO - 2025-10-05 18:35:02 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:35:02 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 18:35:02 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 18:35:02 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 18:35:02 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 18:35:02 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:35:02 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 18:35:02 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 18:35:02 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 18:35:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:35:07 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:35:07 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:35:07 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:35:07 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:35:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:35:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:35:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:35:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:35:07 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:35:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:35:26 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:35:26 --> No existe formulario - primera vez
DEBUG - 2025-10-05 18:35:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:35:26 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:35:26 --> No existe formulario - primera vez
INFO - 2025-10-05 18:35:26 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"34","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"35","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"36","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"37","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"38","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"39","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"40","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"41","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"42","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"43","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 18:35:26 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 18:35:26 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"7","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:35:26 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:35:26 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["1"]}}
INFO - 2025-10-05 18:35:26 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 18:35:26 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:35:26 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 18:35:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:35:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:36:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:36:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:36:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:36:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:36:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:36:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:36:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:36:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:36:07 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:36:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:36:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:37:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:37:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:37:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:37:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:37:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 2
INFO - 2025-10-05 18:37:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 2
INFO - 2025-10-05 18:37:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:37:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:37:07 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:37:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:37:14 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:37:14 --> No existe formulario - primera vez
INFO - 2025-10-05 18:37:14 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"34","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"35","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"36","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"37","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"38","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"39","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"40","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"41","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"42","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"43","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 18:37:14 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 18:37:14 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"7","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 18:37:14 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:37:14 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["3"],"tipos_egreso":["1"]}}
INFO - 2025-10-05 18:37:14 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 18:37:14 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 18:37:14 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 18:37:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:37:58 --> Verificando acceso médico - ate_codigo: 2, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:37:58 --> No existe formulario - primera vez
INFO - 2025-10-05 18:37:58 --> 🔍 DEBUG CREAR REGISTRO - ate_codigo: 2, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:37:58 --> Creando registro formulario: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","observaciones":"Completado en especialidad - are_codigo: 1 - primera vez","modificaciones_permitidas":3,"modificaciones_usadas":0,"habilitado_por_admin":0}
INFO - 2025-10-05 18:37:58 --> Registro de formulario creado exitosamente - ID: 3
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:37:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:38:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:38:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:38:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:38:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:38:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:38:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:38:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:38:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:38:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:38:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asdas","fecha_habilitacion":"2025-10-05 18:32:19","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:38:24 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:38:24 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:32:19","motivo_habilitacion":"asdas"}
INFO - 2025-10-05 18:38:24 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 18:38:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:38:25 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:38:25 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:32:19","motivo_habilitacion":"asdas"}
INFO - 2025-10-05 18:38:25 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:38:25 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 18:38:25 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 18:38:25 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 18:38:25 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 18:38:25 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:38:25 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 18:38:25 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 18:38:25 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 18:38:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:38:33 --> Verificando acceso médico - ate_codigo: 3, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:38:33 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:32:19","motivo_habilitacion":"asdas"}
INFO - 2025-10-05 18:38:33 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:38:33 --> Registrando modificación usada - ate_codigo: 3, sección: ES
INFO - 2025-10-05 18:38:33 --> Modificación por admin - Estado actual: 0/3, incrementando a: 1
INFO - 2025-10-05 18:38:33 --> Modificación por admin DESHABILITADA después de uso - ate_codigo: 3
INFO - 2025-10-05 18:38:33 --> Modificación registrada: 1/3 - OK
INFO - 2025-10-05 18:38:33 --> 🔒 DESHABILITANDO después de usar: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:38:33 --> Deshabilitando modificación usada para sección ES
INFO - 2025-10-05 18:38:33 --> Habilitación DESACTIVADA después de usar para ES: OK
INFO - 2025-10-05 18:38:33 --> Área de atención marcada como COMPLETADA después de usar modificación
INFO - 2025-10-05 18:38:33 --> ✅ DESHABILITACIÓN EXITOSA: ate_codigo=3 para ES - REMOVIDO DE LISTA
DEBUG - 2025-10-05 18:38:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:38:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:39:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:39:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:39:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:39:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:39:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:39:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:39:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:39:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:39:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:39:06 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:39:20 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:39:20 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:39:20 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:39:20 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:39:20 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:39:20 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:39:20 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:39:20 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:39:20 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:39:20 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:39:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:39:21 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:39:21 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:39:21 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:39:21 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:39:21 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:39:21 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:39:21 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:39:21 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:39:21 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:39:21 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:39:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:39:24 --> 🔄 Iniciando habilitarModificacion: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:39:24 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 3, seccion: ES
INFO - 2025-10-05 18:39:24 --> Formulario encontrado: SÍ
INFO - 2025-10-05 18:39:24 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada"}
INFO - 2025-10-05 18:39:24 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 18:39:24"}
INFO - 2025-10-05 18:39:24 --> Formulario actualizado exitosamente
INFO - 2025-10-05 18:39:24 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:39:24 --> Procesando reenvío para sección ES - MANTENIENDO habilitación admin
INFO - 2025-10-05 18:39:24 --> Área de atención actualizada para modificación: OK
INFO - 2025-10-05 18:39:24 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=3 para ES - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 18:39:24 --> Reenvío completado exitosamente
INFO - 2025-10-05 18:39:24 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 18:39:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:39:24 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:39:24 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:39:24 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:39:24 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:39:24 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:39:24 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:39:24 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:39:24 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:39:24 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:39:24 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 18:39:24","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"1","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:39:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:39:36 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:39:36 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:39:24","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 18:39:36 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 18:39:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:39:36 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 18:39:36 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:39:24","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 18:39:36 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:39:36 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 18:39:36 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 18:39:36 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 18:39:36 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 18:39:36 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 18:39:36 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 18:39:36 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 18:39:36 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 18:39:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:39:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:39:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:39:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:39:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:39:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:39:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:39:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:39:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 18:39:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:39:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:39:48 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 18:39:24","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"1","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:40:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:40:13 --> Verificando acceso médico - ate_codigo: 3, usu_id: 8, seccion: ES
INFO - 2025-10-05 18:40:13 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 18:39:24","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 18:40:13 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 18:40:13 --> Registrando modificación usada - ate_codigo: 3, sección: ES
INFO - 2025-10-05 18:40:13 --> Modificación por admin - Estado actual: 1/3, incrementando a: 2
INFO - 2025-10-05 18:40:13 --> Modificación por admin DESHABILITADA después de uso - ate_codigo: 3
INFO - 2025-10-05 18:40:13 --> Modificación registrada: 2/3 - OK
INFO - 2025-10-05 18:40:13 --> 🔒 DESHABILITANDO después de usar: ate_codigo=3, seccion=ES
INFO - 2025-10-05 18:40:13 --> Deshabilitando modificación usada para sección ES
INFO - 2025-10-05 18:40:13 --> Habilitación DESACTIVADA después de usar para ES: OK
INFO - 2025-10-05 18:40:13 --> Área de atención marcada como COMPLETADA después de usar modificación
INFO - 2025-10-05 18:40:13 --> ✅ DESHABILITACIÓN EXITOSA: ate_codigo=3 para ES - REMOVIDO DE LISTA
DEBUG - 2025-10-05 18:40:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:40:19 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:40:19 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:40:19 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:40:19 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:40:19 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:40:19 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:40:19 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:40:19 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:40:19 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:40:19 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:40:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:40:55 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:40:55 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:40:55 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:40:55 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:40:55 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:40:55 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:40:55 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:40:55 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:40:55 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:40:55 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:41:19 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:41:19 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:41:19 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:41:19 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:41:19 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:41:19 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:41:19 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:41:19 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:41:19 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:41:19 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:41:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:41:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:41:49 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:41:49 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:41:49 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:41:49 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:41:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:41:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:41:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:41:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:41:49 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:41:49 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:42:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:42:50 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:42:50 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:42:50 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:42:50 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:42:50 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:42:50 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:42:50 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:42:50 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:42:50 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:42:50 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:43:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:43:51 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:43:51 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:43:51 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:43:51 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:43:51 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:43:51 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:43:51 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:43:51 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:43:51 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:43:51 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:44:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:44:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:44:52 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:44:52 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:44:52 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:44:52 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:44:52 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:44:52 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:44:52 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:44:52 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:44:52 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:44:52 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:45:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:45:53 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:45:53 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:45:53 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:45:53 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:45:53 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:45:53 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:45:53 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:45:53 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:45:53 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:45:53 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:46:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:46:54 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:46:54 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:46:54 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:46:54 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:46:54 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:46:54 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:46:54 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:46:54 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:46:54 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:46:54 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:47:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:47:55 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:47:55 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:47:55 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:47:55 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:47:55 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:47:55 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:47:55 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:47:55 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:47:55 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:47:55 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:48:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:48:56 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:48:56 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:48:56 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:48:56 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:48:56 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:48:56 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:48:56 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:48:56 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:48:56 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:48:56 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:49:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:49:57 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:49:57 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:49:57 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:49:57 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:49:57 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:49:57 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:49:57 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:49:57 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:49:57 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:49:57 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:50:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:50:58 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:50:58 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:50:58 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:50:58 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:50:58 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:50:58 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:50:58 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:50:58 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:50:58 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:50:58 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:51:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:52:01 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:52:01 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:52:01 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:52:01 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:52:01 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:52:01 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:52:01 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:52:01 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:52:01 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:52:01 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:52:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:52:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:52:59 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:52:59 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:52:59 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:52:59 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:53:00 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:53:00 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:53:00 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:53:00 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:53:00 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:53:00 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:53:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:53:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:53:29 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:53:29 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:53:29 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:53:29 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:53:29 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:53:29 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:53:29 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:53:29 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:53:29 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:53:29 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:53:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:53:49 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:53:49 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:53:49 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:53:49 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:53:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:53:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:53:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:53:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:53:49 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:53:49 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:54:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:54:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:54:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:54:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:54:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:54:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:54:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:54:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:54:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:54:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:54:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:54:18 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:54:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:54:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:54:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:54:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:54:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:54:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:54:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:54:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:54:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:54:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:54:48 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:55:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:55:49 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:55:49 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:55:49 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:55:49 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:55:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:55:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:55:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:55:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:55:49 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:55:49 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:55:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:55:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:56:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:56:01 --> Logout - Usuario: especialista1, ID: 6
DEBUG - 2025-10-05 18:56:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:56:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:56:10 --> Login exitoso - Usuario: admision1, ID: 2, Rol: ADMISIONISTA
DEBUG - 2025-10-05 18:56:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:56:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:56:50 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:56:50 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:56:50 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:56:50 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:56:50 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:56:50 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:56:50 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:56:50 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:56:50 --> 🔍 DEBUG REGISTRO 2 - Paciente: CRISTOFER STEVEN BEDOYA IPIALES, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:56:50 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:57:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:12 --> Logout - Usuario: admision1, ID: 2
DEBUG - 2025-10-05 18:57:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:16 --> Login exitoso - Usuario: enfermeria1, ID: 3, Rol: ENFERMERIA
DEBUG - 2025-10-05 18:57:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:38 --> Logout - Usuario: enfermeria1, ID: 3
DEBUG - 2025-10-05 18:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:47 --> Login exitoso - Usuario: medico1, ID: 4, Rol: MEDICO_TRIAJE
DEBUG - 2025-10-05 18:57:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:48 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 18:57:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:51 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:57:51 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:57:51 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:57:51 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:57:51 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:57:51 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:57:51 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:57:51 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:57:51 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:57:51 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:57:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:55 --> Verificando acceso médico - ate_codigo: 4, usu_id: 4, seccion: ME
INFO - 2025-10-05 18:57:55 --> No existe formulario - primera vez
DEBUG - 2025-10-05 18:57:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:55 --> Verificando acceso médico - ate_codigo: 4, usu_id: 4, seccion: ME
INFO - 2025-10-05 18:57:55 --> No existe formulario - primera vez
DEBUG - 2025-10-05 18:57:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:57:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:57:56 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 18:57:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:58:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:58:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:58:27 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 18:58:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:58:52 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:58:52 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:58:52 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:58:52 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:58:52 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:58:52 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:58:52 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:58:52 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:58:52 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:58:52 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:58:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:58:55 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 18:58:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:59:25 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 18:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 18:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:59:53 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 18:59:53 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 18:59:53 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 18:59:53 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 18:59:53 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 3
INFO - 2025-10-05 18:59:53 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 3
INFO - 2025-10-05 18:59:53 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:59:53 --> 🔍 DEBUG REGISTRO 1 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 18:59:53 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 18:59:53 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 18:59:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 18:59:55 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 18:59:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:08 --> Verificando acceso médico - ate_codigo: 4, usu_id: 4, seccion: ME
INFO - 2025-10-05 19:00:08 --> No existe formulario - primera vez
INFO - 2025-10-05 19:00:09 --> 🔍 DEBUG CREAR REGISTRO - ate_codigo: 4, usu_id: 4, seccion: ME
INFO - 2025-10-05 19:00:09 --> Creando registro formulario: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","observaciones":"Completado en triaje m\u00e9dico - primera vez","modificaciones_permitidas":3,"modificaciones_usadas":0,"habilitado_por_admin":0}
INFO - 2025-10-05 19:00:09 --> Registro de formulario creado exitosamente - ID: 4
DEBUG - 2025-10-05 19:00:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:22 --> LISTA MÉDICOS: 0 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 19:00:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:25 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:00:25 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:00:25 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:00:25 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:00:25 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:00:25 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:00:25 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:00:25 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:00:25 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:00:25 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:00:25 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","motivo_habilitacion":null,"fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"0","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:32 --> 🔄 Iniciando habilitarModificacion: ate_codigo=4, seccion=ME
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 4, seccion: ME
INFO - 2025-10-05 19:00:32 --> Formulario encontrado: SÍ
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"4","ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":null}
INFO - 2025-10-05 19:00:32 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"sadasd","fecha_habilitacion":"2025-10-05 19:00:32"}
INFO - 2025-10-05 19:00:32 --> Formulario actualizado exitosamente
INFO - 2025-10-05 19:00:32 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=4, seccion=ME
INFO - 2025-10-05 19:00:32 --> Procesando reenvío para sección ME - MANTENIENDO habilitación admin para modificación
INFO - 2025-10-05 19:00:32 --> Asignaciones de especialidad eliminadas: SÍ
INFO - 2025-10-05 19:00:32 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=4 para ME - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 19:00:32 --> Reenvío completado exitosamente
INFO - 2025-10-05 19:00:32 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 19:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:00:32 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:00:32 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:00:32 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 1
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:00:32 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:00:32 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"sadasd","fecha_habilitacion":"2025-10-05 19:00:32","pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"0","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:34 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 19:00:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:36 --> Verificando acceso médico - ate_codigo: 4, usu_id: 4, seccion: ME
INFO - 2025-10-05 19:00:36 --> Formulario encontrado: {"id":"4","ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:00:32","motivo_habilitacion":"sadasd"}
INFO - 2025-10-05 19:00:36 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 19:00:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:36 --> Verificando acceso médico - ate_codigo: 4, usu_id: 4, seccion: ME
INFO - 2025-10-05 19:00:36 --> Formulario encontrado: {"id":"4","ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:00:32","motivo_habilitacion":"sadasd"}
INFO - 2025-10-05 19:00:36 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 19:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:37 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 19:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:46 --> Verificando acceso médico - ate_codigo: 4, usu_id: 4, seccion: ME
INFO - 2025-10-05 19:00:46 --> Formulario encontrado: {"id":"4","ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:00:32","motivo_habilitacion":"sadasd"}
INFO - 2025-10-05 19:00:46 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:00:46 --> Registrando modificación usada - ate_codigo: 4, sección: ME
INFO - 2025-10-05 19:00:46 --> Modificación por admin - Estado actual: 0/3, incrementando a: 1
INFO - 2025-10-05 19:00:46 --> Modificación por admin DESHABILITADA después de uso - ate_codigo: 4
INFO - 2025-10-05 19:00:46 --> Modificación registrada: 1/3 - OK
INFO - 2025-10-05 19:00:46 --> 🔒 DESHABILITANDO después de usar: ate_codigo=4, seccion=ME
INFO - 2025-10-05 19:00:46 --> Deshabilitando modificación usada para sección ME
INFO - 2025-10-05 19:00:46 --> Habilitación DESACTIVADA después de usar para ME: OK
INFO - 2025-10-05 19:00:46 --> ✅ DESHABILITACIÓN EXITOSA: ate_codigo=4 para ME - REMOVIDO DE LISTA
DEBUG - 2025-10-05 19:00:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:00:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:00:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:00:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:00:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:00:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:00:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:00:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:00:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:00:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:00:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:00:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:00:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:00:53 --> LISTA MÉDICOS: 0 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 19:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:01:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:01:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:01:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:01:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:01:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:01:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:01:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:01:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:01:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:01:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:01:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:01:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:01:24 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 19:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:01:28 --> Logout - Usuario: especialista1, ID: 6
DEBUG - 2025-10-05 19:01:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:01:31 --> Login exitoso - Usuario: admision1, ID: 2, Rol: ADMISIONISTA
DEBUG - 2025-10-05 19:01:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:01:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:01:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:01:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:01:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:01:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:01:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:01:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:01:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:01:49 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:01:49 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:01:49 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:01:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:01:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:01:59 --> Logout - Usuario: admision1, ID: 2
DEBUG - 2025-10-05 19:01:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:03 --> Login exitoso - Usuario: enfermeria1, ID: 3, Rol: ENFERMERIA
DEBUG - 2025-10-05 19:02:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:18 --> Logout - Usuario: enfermeria1, ID: 3
DEBUG - 2025-10-05 19:02:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:27 --> Login exitoso - Usuario: medico1, ID: 4, Rol: MEDICO_TRIAJE
DEBUG - 2025-10-05 19:02:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:27 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 19:02:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:30 --> Verificando acceso médico - ate_codigo: 5, usu_id: 4, seccion: ME
INFO - 2025-10-05 19:02:30 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:02:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:30 --> Verificando acceso médico - ate_codigo: 5, usu_id: 4, seccion: ME
INFO - 2025-10-05 19:02:30 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:02:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:31 --> LISTA MÉDICOS: 1 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 19:02:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:49 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:02:49 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:02:49 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:02:49 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:02:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:02:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:02:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:02:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:02:49 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:02:49 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:02:49 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:02:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:50 --> LISTA MÉDICOS: 0 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 19:02:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:52 --> Logout - Usuario: medico1, ID: 4
DEBUG - 2025-10-05 19:02:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:02:57 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 19:02:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:03:40 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:03:40 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:03:40 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:03:40 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:03:40 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:03:40 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:03:40 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:03:40 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:03:40 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:03:40 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:03:40 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:03:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:03:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:03:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:03:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:03:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:03:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:03:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:03:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:03:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:03:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:03:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:03:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:03:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:03:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:03:59 --> 🔄 Iniciando habilitarModificacion: ate_codigo=3, seccion=ES
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 3, seccion: ES
INFO - 2025-10-05 19:03:59 --> Formulario encontrado: SÍ
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada"}
INFO - 2025-10-05 19:03:59 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59"}
INFO - 2025-10-05 19:03:59 --> Formulario actualizado exitosamente
INFO - 2025-10-05 19:03:59 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=3, seccion=ES
INFO - 2025-10-05 19:03:59 --> Procesando reenvío para sección ES - MANTENIENDO habilitación admin
INFO - 2025-10-05 19:03:59 --> Área de atención actualizada para modificación: OK
INFO - 2025-10-05 19:03:59 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=3 para ES - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 19:03:59 --> Reenvío completado exitosamente
INFO - 2025-10-05 19:03:59 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 19:03:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:03:59 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:03:59 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:03:59 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:03:59 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:03:59 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:03:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:04:07 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:04:07 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:04:07 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 19:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:04:08 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:04:08 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:04:08 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:04:08 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"61","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:04:08 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:04:08 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"16","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:04:08 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:04:08 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:04:08 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:04:08 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:04:08 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:04:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:04:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:04:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:04:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:04:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:04:19 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:04:19 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:04:19 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:04:19 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:04:19 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:04:19 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:04:19 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:04:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:04:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:04:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:04:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:04:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:04:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:04:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:04:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:04:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:04:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:04:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:04:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:04:48 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:05:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:05:49 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:05:49 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:05:49 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:05:49 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:05:50 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:05:50 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:05:50 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:05:50 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:05:50 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:05:50 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:05:50 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:05:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:05:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:06:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:06:50 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:06:50 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:06:50 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:06:50 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:06:51 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:06:51 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:06:51 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:06:51 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:06:51 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:06:51 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:06:51 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:07:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:07:51 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:07:51 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:07:51 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:07:51 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:07:52 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:07:52 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:07:52 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:07:52 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:07:52 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:07:52 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:07:52 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:08:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:08:14 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:08:14 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:08:14 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 19:08:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:08:14 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:08:14 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:08:14 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:08:14 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"61","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:08:14 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:08:14 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"16","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:08:14 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:08:14 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:08:14 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:08:14 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:08:14 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:08:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:08:52 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:08:52 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:08:52 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:08:52 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:08:52 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:08:52 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:08:52 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:08:52 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:08:52 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:08:52 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:08:52 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:08:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:08:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:09:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:09:53 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:09:53 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:09:53 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:09:53 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:09:53 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:09:53 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:09:53 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:09:53 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:09:53 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:09:53 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:09:53 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:10:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:10:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:10:54 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:10:54 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:10:54 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:10:54 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:10:54 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:10:54 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:10:54 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:10:54 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:10:54 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:10:54 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:10:54 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:11:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:11:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:11:55 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:11:55 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:11:55 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:11:55 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:11:55 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:11:55 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:11:55 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:11:55 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:11:55 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:11:55 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:11:55 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:12:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:12:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:12:56 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:12:56 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:12:56 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:12:56 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:12:56 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:12:56 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:12:56 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:12:56 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:12:56 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:12:56 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:12:56 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:13:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:13:57 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:13:57 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:13:57 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:13:57 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:13:58 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:13:58 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:13:58 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:13:58 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:13:58 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:13:58 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:13:58 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:14:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:14:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:14:58 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:14:58 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:14:58 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:14:58 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:14:58 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:14:58 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:14:58 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:14:58 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:14:58 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:14:58 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:14:58 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:15:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:15:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:15:59 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:15:59 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:15:59 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:15:59 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:15:59 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:15:59 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:15:59 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:15:59 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:15:59 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:15:59 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:15:59 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:16:32 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:16:32 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:16:32 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:16:32 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"61","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:16:32 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:16:32 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"16","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:16:32 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:16:32 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:16:32 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:16:32 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:16:32 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:16:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:16:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:16:36 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:16:36 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:16:36 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:16:36 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"61","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:16:36 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:16:36 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"16","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:16:36 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:16:36 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:16:36 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:16:36 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:16:36 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:16:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:17:00 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:17:00 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:17:00 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:17:00 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:17:00 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:17:00 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:17:00 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:17:00 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:17:00 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:17:00 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:17:00 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:17:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:18:01 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:18:01 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:18:01 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:18:01 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:18:01 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:18:01 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:18:01 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:18:01 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:18:01 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:18:01 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:18:01 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:18:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:19:02 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:19:02 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:19:02 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:19:02 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:19:02 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:19:02 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:19:02 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:19:02 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:19:02 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:19:02 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:19:02 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:19:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:20:03 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:20:03 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:20:03 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:20:03 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:20:03 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:20:03 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:20:03 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:20:03 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:20:03 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:20:03 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:20:03 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:20:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:21:04 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:21:04 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:21:04 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:21:04 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:21:04 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:21:04 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:21:04 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:21:04 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:21:04 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:21:04 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:21:04 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:21:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:21:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:21:57 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:21:57 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:21:57 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:21:57 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"61","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:21:57 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:21:57 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"16","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:21:57 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:21:57 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:21:57 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:21:57 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:21:57 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:21:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:22:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:22:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:22:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:22:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:22:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:22:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:22:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:22:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:22:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:22:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:22:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:22:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:22:18 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:22:18 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:22:18 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 19:22:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:22:18 --> Verificando acceso médico - ate_codigo: 3, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:22:18 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:22:18 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:22:18 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"61","ate_codigo":"3","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:22:18 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:22:18 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"16","ate_codigo":"3","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:22:18 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:22:18 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PPRUENAS"},"seccionI":{"descripcion":"PPRUENAS"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"PPRUENAS"}},"seccionM":{"diagnostico1":{"descripcion":"PPRUENAS","cie":"A15.5"}},"seccionN":{"plan_general":"PPRUENAS","tratamientos":[{"trat_id":"16","medicamento":"PPRUENAS","via":"PPRUENAS","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"17","medicamento":"AAS 300 mg VO stat","via":"intravenosa","dosis":"300 mg VO stat, luego 100 mg\/d\u00eda","posologia":"luego ","dias":"","administrado":1},{"trat_id":"18","medicamento":"OBSERVACION77s","via":"ENVIO ENFEMREIA 29","dosis":"CC99","posologia":"asdmn,FFD","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"HSVPOES","egr_observaciones":"prueba no aplica Enviado a observaci\u00f3n de emergencia","egr_dias_reposo":"0","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:22:18 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:22:18 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:22:18 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:22:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:22:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:23:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:23:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:23:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:23:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:23:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:23:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:23:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:23:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:23:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:23:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:23:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:23:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:23:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:24:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:24:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:24:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:24:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:24:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:24:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:24:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:24:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:06 --> 🔍 Primer resultado: {"ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","motivo_habilitacion":"asdasd","fecha_habilitacion":"2025-10-05 19:03:59","pac_nombres":"ERIKA SAMIRA","pac_apellidos":"CAICEDO HUERTAS","pac_cedula":"333333","pac_his_cli":"266462","ate_fecha":"2025-10-05","ate_hora":"17:06:07","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:17:26","modificaciones_count":"2","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:24:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:24:31 --> Verificando acceso médico - ate_codigo: 3, usu_id: 8, seccion: ES
INFO - 2025-10-05 19:24:31 --> Formulario encontrado: {"id":"2","ate_codigo":"3","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:17:26","modificaciones_permitidas":"3","modificaciones_usadas":"2","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:03:59","motivo_habilitacion":"asdasd"}
INFO - 2025-10-05 19:24:31 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:24:31 --> Registrando modificación usada - ate_codigo: 3, sección: ES
INFO - 2025-10-05 19:24:31 --> Modificación por admin - Estado actual: 2/3, incrementando a: 3
INFO - 2025-10-05 19:24:31 --> Modificación por admin DESHABILITADA después de uso - ate_codigo: 3
INFO - 2025-10-05 19:24:31 --> Modificación registrada: 3/3 - OK
INFO - 2025-10-05 19:24:31 --> 🔒 DESHABILITANDO después de usar: ate_codigo=3, seccion=ES
INFO - 2025-10-05 19:24:31 --> Deshabilitando modificación usada para sección ES
INFO - 2025-10-05 19:24:31 --> Habilitación DESACTIVADA después de usar para ES: OK
INFO - 2025-10-05 19:24:31 --> Área de atención marcada como COMPLETADA después de usar modificación
INFO - 2025-10-05 19:24:31 --> ✅ DESHABILITACIÓN EXITOSA: ate_codigo=3 para ES - REMOVIDO DE LISTA
DEBUG - 2025-10-05 19:24:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:24:40 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:24:40 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:24:40 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:40 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:24:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:24:40 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:24:40 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:24:40 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:40 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:40 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:24:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:24:44 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:24:44 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:24:44 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:24:44 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:24:44 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:24:44 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:24:44 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:44 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:44 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:44 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:44 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:24:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:24:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:24:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:24:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:24:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:24:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:24:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:24:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:24:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:24:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:24:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:25:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:25:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:25:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:25:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:25:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:25:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:25:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:25:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:25:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:25:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:25:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:25:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:25:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:25:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:25:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:25:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:25:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:25:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:25:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:25:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:25:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:25:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:25:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:25:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:26:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:26:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:26:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:26:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:26:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:26:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:26:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:26:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:26:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:26:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:26:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:26:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:26:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:26:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:26:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:26:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:26:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:26:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:26:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:26:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:26:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:26:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:26:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:26:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:26:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:27:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:27:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:27:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:27:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:27:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:27:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:27:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:27:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:27:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:27:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:27:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:27:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:27:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:27:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:27:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:27:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:27:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:27:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:27:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:27:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:27:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:27:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:27:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:27:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:28:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:28:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:28:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:28:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:28:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:28:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:28:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:28:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:28:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:28:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:28:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:28:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:28:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:28:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:28:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:28:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:28:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:28:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:28:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:28:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:28:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:28:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:28:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:28:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:28:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:29:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:29:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:29:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:29:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:29:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:29:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:29:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:29:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:29:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:29:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:29:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:29:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:29:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:29:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:29:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:29:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:29:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:29:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:29:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:29:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:29:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:29:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:29:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:29:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:29:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:30:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:30:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:30:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:30:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:30:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:30:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:30:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:30:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:30:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:30:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:30:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:30:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:30:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:30:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:30:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:30:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:30:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:30:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:30:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:30:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:30:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:30:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:30:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:30:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:31:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:31:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:31:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:31:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:31:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:31:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:31:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:31:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:31:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:31:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:31:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:31:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:31:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:31:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:31:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:31:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:31:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:31:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:31:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:31:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:31:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:31:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:31:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:31:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:31:48 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:32:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:32:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:32:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:32:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:32:18 --> 🔍 Primer resultado: {"ate_codigo":"4","usu_id":"4","seccion":"ME","fecha":"2025-10-05 19:00:09","modificaciones_permitidas":"3","modificaciones_usadas":"1","habilitado_por_admin":"0","motivo_habilitacion":"Modificaci\u00f3n utilizada - habilitaci\u00f3n desactivada","fecha_habilitacion":null,"pac_nombres":"YOLANDA DEL TRANSITO","pac_apellidos":"CARRERA POMASQUI","pac_cedula":"666666","pac_his_cli":"354049","ate_fecha":"2025-10-05","ate_hora":"18:57:10","usu_nombre":"Alex Pablo","usu_apellido":"Guerrero Santa Fe","rol_nombre":"MEDICO_TRIAJE","admin_nombre":null,"admin_apellido":null,"puede_modificar":"1","motivo_bloqueo":"Puede modificar naturalmente","estado_boton_admin":"PUEDE_HABILITAR","ultimo_usuario":"Alex Pablo Guerrero Santa Fe","fecha_ultima_modificacion":"2025-10-05 19:00:09","modificaciones_count":"1","tipo_profesional":"M\u00e9dico de Triaje"}
DEBUG - 2025-10-05 19:32:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:32:18 --> 🔄 Iniciando habilitarModificacion: ate_codigo=2, seccion=ES
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 2, seccion: ES
INFO - 2025-10-05 19:32:18 --> Formulario encontrado: SÍ
INFO - 2025-10-05 19:32:18 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":null}
INFO - 2025-10-05 19:32:18 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18"}
INFO - 2025-10-05 19:32:18 --> Formulario actualizado exitosamente
INFO - 2025-10-05 19:32:18 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=2, seccion=ES
INFO - 2025-10-05 19:32:18 --> Procesando reenvío para sección ES - MANTENIENDO habilitación admin
INFO - 2025-10-05 19:32:18 --> Área de atención actualizada para modificación: OK
INFO - 2025-10-05 19:32:18 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=2 para ES - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 19:32:18 --> Reenvío completado exitosamente
INFO - 2025-10-05 19:32:18 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 19:32:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:32:19 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:32:19 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:32:19 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:32:19 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:32:19 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:32:19 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:32:19 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:32:19 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:32:19 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:32:19 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:32:19 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:32:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:32:26 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:32:26 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 19:32:26 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 19:32:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:32:26 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:32:26 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 19:32:26 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:32:26 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 19:32:26 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 19:32:26 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:32:26 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:32:26 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:32:26 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 19:32:26 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:32:26 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 19:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:32:44 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:32:44 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:32:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:32:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:32:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:32:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:32:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:32:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:32:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:32:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:32:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:32:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:32:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:32:48 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:32:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:32:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:33:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:33:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:33:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:33:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:33:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:33:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:33:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:33:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:33:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:33:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:33:18 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:33:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:33:52 --> 📄 Número de hoja asignado para atención 5: 00003
INFO - 2025-10-05 19:33:52 --> 🔄 Procesando evolución 0: {"ep_fecha":"2025-10-05","ep_hora":"19:33","ep_notas_evolucion":"prubas no aplica1","ep_farmacoterapia":"prubas no aplica1","ep_administrado":0,"ep_orden":1,"ep_numero_hoja":"00003"}
INFO - 2025-10-05 19:33:52 --> 📦 Datos preparados para guardar: {"ate_codigo":"5","ep_fecha":"2025-10-05","ep_hora":"19:33","ep_notas_evolucion":"prubas no aplica1","ep_farmacoterapia":"prubas no aplica1","ep_administrado":0,"ep_orden":1,"ep_numero_hoja":"00003","usu_id_registro":"6"}
INFO - 2025-10-05 19:33:52 --> 🔍 Buscando registro - ep_codigo_existente: ''
INFO - 2025-10-05 19:33:52 --> 🔍 Registros existentes disponibles: []
INFO - 2025-10-05 19:33:52 --> 🆕 No se encontró registro existente, insertando nuevo
INFO - 2025-10-05 19:33:52 --> ✅ Insertado nuevo registro con ep_administrado: 0
INFO - 2025-10-05 19:33:52 --> 🔄 Procesando evolución 1: {"ep_fecha":"2025-10-05","ep_hora":"19:33","ep_notas_evolucion":"prubas no aplica2","ep_farmacoterapia":"prubas no aplica2","ep_administrado":0,"ep_orden":2,"ep_numero_hoja":"00003"}
INFO - 2025-10-05 19:33:52 --> 📦 Datos preparados para guardar: {"ate_codigo":"5","ep_fecha":"2025-10-05","ep_hora":"19:33","ep_notas_evolucion":"prubas no aplica2","ep_farmacoterapia":"prubas no aplica2","ep_administrado":0,"ep_orden":2,"ep_numero_hoja":"00003","usu_id_registro":"6"}
INFO - 2025-10-05 19:33:52 --> 🔍 Buscando registro - ep_codigo_existente: ''
INFO - 2025-10-05 19:33:52 --> 🔍 Registros existentes disponibles: []
INFO - 2025-10-05 19:33:52 --> 🆕 No se encontró registro existente, insertando nuevo
INFO - 2025-10-05 19:33:52 --> ✅ Insertado nuevo registro con ep_administrado: 0
INFO - 2025-10-05 19:33:52 --> Evoluciones procesadas - Actualizados: 0, Insertados: 2, Eliminados: 0
DEBUG - 2025-10-05 19:33:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:33:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:34:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:34:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:34:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:34:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:34:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:34:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:34:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:34:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:34:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:34:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:34:06 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:34:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:34:13 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:34:13 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:34:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:34:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:35:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:35:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:35:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:35:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:35:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:35:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:35:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:35:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:35:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:35:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:35:06 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:35:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:36:07 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:36:07 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:36:07 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:36:07 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:36:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:36:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:36:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:36:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:36:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:36:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:36:07 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:36:53 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:36:53 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:36:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:36:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:37:07 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:37:07 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:37:07 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:37:07 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:37:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:37:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:37:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:37:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:37:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:37:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:37:07 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:37:33 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 19:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:37:46 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:37:46 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:37:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:38:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:38:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:38:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:38:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:38:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:38:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:38:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:38:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:38:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:38:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:38:06 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:39:07 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:39:07 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:39:07 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:39:07 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:39:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:39:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:39:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:39:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:39:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:39:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:39:07 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:39:22 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:39:22 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:39:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:39:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:39:57 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:39:57 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:39:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:40:07 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:40:07 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:40:07 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:40:07 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:40:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:40:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:40:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:40:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:40:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:40:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:40:07 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:40:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:40:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:40:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:40:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:40:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:40:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:40:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:40:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:40:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:40:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:40:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:40:18 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:40:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:40:45 --> 📄 Número de hoja asignado para atención 5: 00003
INFO - 2025-10-05 19:40:45 --> 🔄 Procesando evolución 0: {"ep_fecha":"2025-10-05","ep_hora":"19:33:00","ep_notas_evolucion":"prubas no aplica1","ep_farmacoterapia":"prubas no aplica1","ep_administrado":1,"ep_orden":1,"ep_numero_hoja":"00003","ep_codigo":"7"}
INFO - 2025-10-05 19:40:45 --> 📦 Datos preparados para guardar: {"ate_codigo":"5","ep_fecha":"2025-10-05","ep_hora":"19:33:00","ep_notas_evolucion":"prubas no aplica1","ep_farmacoterapia":"prubas no aplica1","ep_administrado":1,"ep_orden":1,"ep_numero_hoja":"00003","usu_id_registro":"6"}
INFO - 2025-10-05 19:40:45 --> 🔍 Buscando registro - ep_codigo_existente: '7'
INFO - 2025-10-05 19:40:45 --> 🔍 Registros existentes disponibles: [7,8]
INFO - 2025-10-05 19:40:45 --> ✅ Encontrado registro existente con ep_codigo: 7
INFO - 2025-10-05 19:40:45 --> ✅ Actualizado registro ep_codigo: 7 con ep_administrado: 1
INFO - 2025-10-05 19:40:45 --> 🔄 Procesando evolución 1: {"ep_fecha":"2025-10-05","ep_hora":"19:33:00","ep_notas_evolucion":"prubas no aplica2","ep_farmacoterapia":"prubas no aplica2","ep_administrado":1,"ep_orden":2,"ep_numero_hoja":"00003","ep_codigo":"8"}
INFO - 2025-10-05 19:40:45 --> 📦 Datos preparados para guardar: {"ate_codigo":"5","ep_fecha":"2025-10-05","ep_hora":"19:33:00","ep_notas_evolucion":"prubas no aplica2","ep_farmacoterapia":"prubas no aplica2","ep_administrado":1,"ep_orden":2,"ep_numero_hoja":"00003","usu_id_registro":"6"}
INFO - 2025-10-05 19:40:45 --> 🔍 Buscando registro - ep_codigo_existente: '8'
INFO - 2025-10-05 19:40:45 --> 🔍 Registros existentes disponibles: [8]
INFO - 2025-10-05 19:40:45 --> ✅ Encontrado registro existente con ep_codigo: 8
INFO - 2025-10-05 19:40:45 --> ✅ Actualizado registro ep_codigo: 8 con ep_administrado: 1
INFO - 2025-10-05 19:40:45 --> Evoluciones procesadas - Actualizados: 2, Insertados: 0, Eliminados: 0
DEBUG - 2025-10-05 19:40:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:40:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:40:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:40:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:40:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:40:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:40:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:40:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:40:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:40:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:40:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:40:48 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:40:59 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:40:59 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:41:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:41:02 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:41:02 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:41:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:41:02 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:41:02 --> No existe formulario - primera vez
DEBUG - 2025-10-05 19:41:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:41:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:41:49 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:41:49 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:41:49 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:41:49 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:41:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:41:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:41:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:41:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:41:49 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:41:49 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:41:49 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:42:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:42:18 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:42:18 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 19:42:18 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:42:18 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 19:42:18 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 19:42:18 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:42:18 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:42:18 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:42:18 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 19:42:18 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:42:18 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 19:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:42:32 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:42:32 --> No existe formulario - primera vez
INFO - 2025-10-05 19:42:32 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"67","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:42:32 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:42:32 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"22","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:42:32 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:42:32 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"1","estados_egreso":["1","2"],"modalidades_egreso":["2","3"],"tipos_egreso":["1"]}}
INFO - 2025-10-05 19:42:32 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:42:32 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:42:32 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:42:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:42:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:42:50 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:42:50 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:42:50 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:42:50 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:42:50 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 4
INFO - 2025-10-05 19:42:50 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 4
INFO - 2025-10-05 19:42:50 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:42:50 --> 🔍 DEBUG REGISTRO 1 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:42:50 --> 🔍 DEBUG REGISTRO 2 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:42:50 --> 🔍 DEBUG REGISTRO 3 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:42:50 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:43:16 --> Verificando acceso médico - ate_codigo: 5, usu_id: 8, seccion: ES
INFO - 2025-10-05 19:43:16 --> No existe formulario - primera vez
INFO - 2025-10-05 19:43:16 --> 🔍 DEBUG CREAR REGISTRO - ate_codigo: 5, usu_id: 8, seccion: ES
INFO - 2025-10-05 19:43:16 --> Creando registro formulario: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","observaciones":"Completado en especialidad - are_codigo: 3 - primera vez","modificaciones_permitidas":3,"modificaciones_usadas":0,"habilitado_por_admin":0}
INFO - 2025-10-05 19:43:16 --> Registro de formulario creado exitosamente - ID: 5
DEBUG - 2025-10-05 19:43:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:43:23 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:43:23 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:43:23 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:43:23 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:43:23 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:43:23 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:43:23 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:43:23 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:43:23 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:43:23 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:43:23 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:43:23 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:43:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:43:25 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:43:25 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:43:25 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:43:25 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:43:25 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:43:25 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:43:25 --> 🔍 DEBUG REGISTRO 0 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:43:25 --> 🔍 DEBUG REGISTRO 1 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:43:25 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:43:25 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:43:25 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:43:25 --> 🔍 Primer resultado: {"ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"ASDASD","fecha_habilitacion":"2025-10-05 19:32:18","pac_nombres":"CALRA LUZ","pac_apellidos":"CHAMORRO PAILLACHO","pac_cedula":"","pac_his_cli":"106551","ate_fecha":"2025-10-05","ate_hora":"16:31:47","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 18:37:58","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:43:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:43:36 --> 🔄 Iniciando habilitarModificacion: ate_codigo=5, seccion=ES
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG PABLO HABILITAR - Buscando formulario con ate_codigo: 5, seccion: ES
INFO - 2025-10-05 19:43:36 --> Formulario encontrado: SÍ
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG PABLO HABILITAR - Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"0","admin_que_habilito":null,"fecha_habilitacion":null,"motivo_habilitacion":null}
INFO - 2025-10-05 19:43:36 --> Datos a actualizar: {"habilitado_por_admin":1,"admin_que_habilito":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36"}
INFO - 2025-10-05 19:43:36 --> Formulario actualizado exitosamente
INFO - 2025-10-05 19:43:36 --> 📤 INICIANDO reenvío PARA HABILITAR: ate_codigo=5, seccion=ES
INFO - 2025-10-05 19:43:36 --> Procesando reenvío para sección ES - MANTENIENDO habilitación admin
INFO - 2025-10-05 19:43:36 --> Área de atención actualizada para modificación: OK
INFO - 2025-10-05 19:43:36 --> ✅ REENVÍO EXITOSO PARA HABILITACIÓN: ate_codigo=5 para ES - ATENCIÓN ENVIADA A LISTA
INFO - 2025-10-05 19:43:36 --> Reenvío completado exitosamente
INFO - 2025-10-05 19:43:36 --> ✅ Modificación habilitada exitosamente
DEBUG - 2025-10-05 19:43:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:43:36 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:43:36 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:43:36 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:43:36 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:43:36 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:43:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:43:45 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:43:45 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 19:43:45 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 19:43:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:43:45 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:43:45 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 19:43:45 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:43:45 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:43:45 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:43:45 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:43:45 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:43:45 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:43:45 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:43:45 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:43:45 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:43:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:43:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:43:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:43:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:43:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:43:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:43:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:43:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:43:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:43:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:43:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:43:48 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:43:48 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:43:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:43:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:44:18 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:44:18 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:44:18 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:44:18 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:44:18 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:44:18 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:44:18 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:44:18 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:44:18 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:44:18 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:44:18 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:44:18 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:44:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:45:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:45:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:45:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:45:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:45:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:45:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:45:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:45:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:45:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:45:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:45:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:45:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:45:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:46:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:46:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:46:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:46:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:46:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:46:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:46:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:46:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:46:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:46:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:46:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:46:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:46:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:47:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:47:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:47:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:47:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:47:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:47:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:47:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:47:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:47:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:47:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:47:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:47:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:47:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:48:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:48:06 --> 🔍 DEBUG PABLO - Parámetros: []
DEBUG - 2025-10-05 19:48:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:48:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:48:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:48:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:48:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:48:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:48:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:48:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:48:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:48:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:48:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:48:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:49:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:49:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:49:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:49:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:49:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:49:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:49:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:49:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:49:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:49:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:49:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:49:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:49:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:50:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:50:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:50:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:50:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:50:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:50:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:50:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:50:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:50:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:50:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:50:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:50:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:50:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:50:19 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:50:19 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 19:50:19 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:50:19 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:50:19 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:50:19 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:50:19 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:50:19 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:50:19 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:50:19 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:50:19 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:50:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:51:07 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:51:07 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:51:07 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:51:07 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:51:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:51:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:51:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:51:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:51:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:51:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:51:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:51:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:51:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:51:19 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:51:19 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:51:19 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:51:19 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:51:19 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:51:19 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:51:19 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:51:19 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:51:19 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:51:19 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:51:19 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:51:19 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:51:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:51:48 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:51:48 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:51:48 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:51:48 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:51:48 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:51:48 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:51:48 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:51:48 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:51:48 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:51:48 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:51:48 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:51:48 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:52:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:52:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:52:49 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:52:49 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:52:49 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:52:49 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:52:49 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:52:49 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:52:49 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:52:49 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:52:49 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:52:49 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:52:49 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:52:49 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:53:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:53:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:53:51 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:53:51 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:53:51 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:53:51 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:53:51 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:53:51 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:53:51 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:53:51 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:53:51 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:53:51 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:53:51 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:53:51 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:54:24 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 19:54:24 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 19:54:24 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 19:54:24 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 19:54:24 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:54:24 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 19:54:24 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:54:24 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 19:54:24 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 19:54:24 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 19:54:24 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 19:54:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 19:54:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:54:51 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:54:51 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:54:51 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:54:51 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:54:51 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:54:51 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:54:51 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:54:51 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:54:51 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:54:51 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:54:51 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:54:51 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:55:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:55:52 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:55:52 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:55:52 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:55:52 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:55:52 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:55:52 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:55:52 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:55:52 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:55:52 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:55:52 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:55:53 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:55:53 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:56:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:56:54 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:56:54 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:56:54 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:56:54 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:56:54 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:56:54 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:56:54 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:56:54 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:56:54 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:56:54 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:56:54 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:56:54 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:57:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:57:54 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:57:54 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:57:54 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:57:54 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:57:54 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:57:54 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:57:54 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:57:54 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:57:54 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:57:55 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:57:55 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:57:55 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:58:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:58:55 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:58:55 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:58:55 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:58:55 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:58:56 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:58:56 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:58:56 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:58:56 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:58:56 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:58:56 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:58:56 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:58:56 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 19:59:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 19:59:56 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 19:59:56 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 19:59:56 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 19:59:56 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 19:59:56 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 19:59:56 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 19:59:56 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:59:56 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 19:59:56 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:59:56 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 19:59:56 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 19:59:56 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:00:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:00:57 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:00:57 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:00:57 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:00:57 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:00:57 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:00:57 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:00:57 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:00:57 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:00:57 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:00:57 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:00:57 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:00:57 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:01:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:01:59 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:01:59 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:01:59 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:01:59 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:01:59 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:01:59 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:01:59 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:01:59 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:01:59 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:01:59 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:01:59 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:01:59 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:02:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:02:59 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:02:59 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:02:59 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:02:59 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:02:59 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:02:59 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:02:59 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:02:59 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:02:59 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:02:59 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:02:59 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:02:59 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:04:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:04:00 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:04:00 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:04:00 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:04:00 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:04:00 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:04:00 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:04:00 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:04:00 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:04:00 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:04:00 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:04:00 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:04:00 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:05:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:05:01 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:05:01 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:05:01 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:05:01 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:05:01 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:05:01 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:05:01 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:05:01 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:05:01 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:05:01 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:05:01 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:05:01 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:06:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:06:03 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:06:03 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:06:03 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:06:03 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:06:03 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:06:03 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:06:03 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:06:03 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:06:03 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:06:03 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:06:03 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:06:03 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:07:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:07:03 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:07:03 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:07:03 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:07:03 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:07:03 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:07:03 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:07:03 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:07:03 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:07:03 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:07:03 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:07:03 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:07:03 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:08:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:08:04 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:08:04 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:08:04 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:08:04 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:08:04 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:08:04 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:08:04 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:08:04 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:08:04 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:08:04 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:08:04 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:08:04 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:09:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:09:05 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:09:05 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:09:05 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:09:05 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:09:05 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:09:05 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:09:05 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:09:05 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:09:05 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:09:05 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:09:05 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:09:05 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:10:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:10:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:10:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:10:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:10:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:10:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:10:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:10:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:10:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:10:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:10:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:10:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:10:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:10:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:10:20 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:10:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:10:27 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:10:27 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:10:27 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:10:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:10:31 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:10:31 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:10:31 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:10:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:10:31 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:10:31 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:10:31 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:10:31 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:10:31 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:10:31 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:10:31 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:10:31 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:10:31 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:10:31 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:10:31 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:10:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:11:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:11:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:11:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:11:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:11:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:11:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:11:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:11:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:11:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:11:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:11:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:11:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:11:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:12:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:12:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:12:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:12:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:12:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:12:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:12:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:12:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:12:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:12:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:12:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:12:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:12:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:12:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:13:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:13:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:13:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:13:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:13:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:13:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:13:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:13:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:13:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:13:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:13:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:13:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:13:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:13:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:14:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:14:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:14:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:14:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:14:07 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:14:07 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:14:07 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:14:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:14:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:14:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:14:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:14:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:14:17 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:14:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:14:24 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:14:24 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:14:24 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:14:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:14:24 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:14:24 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:14:24 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:14:24 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:14:24 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:14:24 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:14:24 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:14:24 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:14:24 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:14:24 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:14:24 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:14:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:14:47 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:14:47 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:14:47 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:14:47 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:14:47 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:14:47 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:14:47 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:14:47 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:14:47 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:14:47 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:14:47 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:14:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:14:58 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:14:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:14:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:15:05 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:15:05 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:15:05 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:15:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:15:06 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:15:06 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:15:06 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:15:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:15:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:15:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:15:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:15:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:15:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:15:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:16:03 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:16:03 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 20:16:03 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:16:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:16:03 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:16:03 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 20:16:03 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:16:03 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 20:16:03 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:16:03 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:16:03 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:16:03 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:16:03 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:16:03 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:16:03 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 20:16:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:16:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:16:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:16:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:16:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:16:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:16:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:16:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:16:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:16:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:16:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:16:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:16:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:16:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:17:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:17:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:17:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:17:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:17:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:17:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:17:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:17:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:17:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:17:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:17:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:17:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:17:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:17:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:18:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:18:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:18:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:18:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:18:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:18:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:18:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:18:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:18:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:18:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:18:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:18:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:18:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:18:31 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:18:31 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:18:31 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:18:31 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:18:31 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:18:31 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:18:31 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:18:31 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:18:31 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:18:31 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:18:31 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:18:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:18:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:19:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:19:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:19:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:19:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:19:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:19:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:19:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:19:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:19:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:19:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:19:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:19:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:19:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:19:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:20:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:20:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:20:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:20:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:20:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:20:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:20:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:20:07 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:20:07 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:20:07 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:20:07 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:20:07 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:20:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:20:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:21:06 --> 🔍 DEBUG PABLO - Construyendo query con where: fu.seccion IN ('ME', 'ES')
INFO - 2025-10-05 20:21:06 --> 🔍 DEBUG PABLO - Parámetros: []
INFO - 2025-10-05 20:21:06 --> 🔍 Ejecutando query modificaciones con parámetros: []
INFO - 2025-10-05 20:21:06 --> Query completo: 
        SELECT
            fu.ate_codigo,
            fu.usu_id,
            fu.seccion,
            fu.fecha,
            fu.modificaciones_permitidas,
            fu.modificaciones_usadas,
            fu.habilitado_por_admin,
            fu.motivo_habilitacion,
            fu.fecha_habilitacion,

            -- Datos del paciente
            p.pac_nombres,
            p.pac_apellidos,
            p.pac_cedula,
            p.pac_his_cli,

            -- Datos de la atención
            a.ate_fecha,
            a.ate_hora,

            -- Datos del profesional que completó
            u.usu_nombre,
            u.usu_apellido,
            r.rol_nombre,

            -- Datos del admin que habilitó (si aplica)
            admin.usu_nombre as admin_nombre,
            admin.usu_apellido as admin_apellido,

            -- CORREGIDO: Determinar si puede modificar - LÓGICA COMPLETA
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 0  -- NO puede si ya alcanzó el límite
                WHEN fu.habilitado_por_admin = 1 THEN 1  -- SÍ puede si está habilitado por admin
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 1  -- SÍ puede si tiene modificaciones restantes
                ELSE 0
            END as puede_modificar,

            -- CORREGIDO: Motivo del bloqueo si aplica
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'Límite de modificaciones alcanzado (3/3)'
                WHEN fu.habilitado_por_admin = 1 THEN 'Habilitado por administrador'
                WHEN fu.modificaciones_usadas < fu.modificaciones_permitidas THEN 'Puede modificar naturalmente'
                ELSE 'Sin modificaciones disponibles'
            END as motivo_bloqueo,

            -- NUEVO: Estado para el botón del admin
            CASE
                WHEN fu.modificaciones_usadas >= fu.modificaciones_permitidas THEN 'BLOQUEADO'
                WHEN fu.habilitado_por_admin = 1 THEN 'HABILITADO'
                ELSE 'PUEDE_HABILITAR'
            END as estado_boton_admin,

            -- Información del último usuario que modificó
            CONCAT(u.usu_nombre, ' ', u.usu_apellido) as ultimo_usuario,
            fu.fecha as fecha_ultima_modificacion,

            -- Contador de modificaciones
            fu.modificaciones_usadas as modificaciones_count,

            -- Tipo de profesional
            CASE
                WHEN fu.seccion = 'ME' THEN 'Médico de Triaje'
                WHEN fu.seccion = 'ES' THEN 'Médico Especialista'
                ELSE 'Otro'
            END as tipo_profesional

        FROM t_formulario_usuario fu
        JOIN t_atencion a ON fu.ate_codigo = a.ate_codigo
        JOIN t_paciente p ON a.pac_codigo = p.pac_codigo
        JOIN t_usuario u ON fu.usu_id = u.usu_id
        JOIN t_rol r ON u.rol_id = r.rol_id
        LEFT JOIN t_usuario admin ON fu.admin_que_habilito = admin.usu_id

        WHERE fu.seccion IN ('ME', 'ES')

        ORDER BY
            fu.habilitado_por_admin DESC,  -- Modificaciones habilitadas primero
            fu.fecha DESC
        
INFO - 2025-10-05 20:21:06 --> ✅ Query ejecutado exitosamente. Registros obtenidos: 5
INFO - 2025-10-05 20:21:06 --> 🔍 DEBUG TODOS LOS REGISTROS - Total: 5
INFO - 2025-10-05 20:21:06 --> 🔍 DEBUG REGISTRO 0 - Paciente: CRISTOPHER ANGEL GUEVARA ARCOS, ate_codigo: 5, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:21:06 --> 🔍 DEBUG REGISTRO 1 - Paciente: CALRA LUZ CHAMORRO PAILLACHO, ate_codigo: 2, fecha: 2025-10-05, seccion: ES, habilitado: 1
INFO - 2025-10-05 20:21:06 --> 🔍 DEBUG REGISTRO 2 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 4, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:21:06 --> 🔍 DEBUG REGISTRO 3 - Paciente: ERIKA SAMIRA CAICEDO HUERTAS, ate_codigo: 3, fecha: 2025-10-05, seccion: ES, habilitado: 0
INFO - 2025-10-05 20:21:06 --> 🔍 DEBUG REGISTRO 4 - Paciente: YOLANDA DEL TRANSITO CARRERA POMASQUI, ate_codigo: 1, fecha: 2025-10-05, seccion: ME, habilitado: 0
INFO - 2025-10-05 20:21:06 --> 🔍 Primer resultado: {"ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","motivo_habilitacion":"asda","fecha_habilitacion":"2025-10-05 19:43:36","pac_nombres":"CRISTOPHER ANGEL","pac_apellidos":"GUEVARA ARCOS","pac_cedula":"","pac_his_cli":"259044","ate_fecha":"2025-10-05","ate_hora":"19:01:57","usu_nombre":"Pablo Criollo","usu_apellido":"Gonz\u00e1lez Vega","rol_nombre":"MEDICO_ESPECIALISTA","admin_nombre":"Admin","admin_apellido":"Administrador","puede_modificar":"1","motivo_bloqueo":"Habilitado por administrador","estado_boton_admin":"HABILITADO","ultimo_usuario":"Pablo Criollo Gonz\u00e1lez Vega","fecha_ultima_modificacion":"2025-10-05 19:43:16","modificaciones_count":"0","tipo_profesional":"M\u00e9dico Especialista"}
DEBUG - 2025-10-05 20:21:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:21:11 --> Logout - Usuario: administrador, ID: 1
DEBUG - 2025-10-05 20:21:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:21:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:22:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:23:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:26:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:26:15 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:26:15 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:26:15 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:26:15 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:26:15 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:26:15 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:26:15 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:26:15 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:26:15 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:26:15 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:26:15 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:26:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:28:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:29:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:30:10 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:30:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:30:17 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:30:17 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:30:17 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:30:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:30:17 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:30:17 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:30:17 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:30:17 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:30:17 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:30:17 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:30:17 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:30:17 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:30:17 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:30:17 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:30:17 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:30:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:30:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:31:05 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:31:05 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 20:31:05 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:31:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:31:05 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:31:05 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 20:31:05 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:31:05 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 20:31:05 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:31:05 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:31:05 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:31:05 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:31:05 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:31:05 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:31:05 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 20:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:31:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:32:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:33:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:35:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:36:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:37:32 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:37:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:37:38 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:37:38 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:37:38 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:37:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:37:39 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:37:39 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:37:39 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:37:39 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:37:39 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:37:39 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:37:39 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:37:39 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:37:39 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:37:39 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:37:39 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:37:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:38:18 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:38:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:38:26 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:38:26 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 20:38:26 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:38:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:38:26 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:38:26 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 20:38:26 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:38:26 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 20:38:26 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:38:26 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:38:26 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:38:26 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:38:26 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:38:26 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:38:26 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 20:38:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:38:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:39:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:40:02 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:40:02 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 20:40:02 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:40:02 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 20:40:02 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:40:02 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:40:02 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:40:02 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:40:02 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:40:02 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:40:02 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 20:40:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:40:35 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:40:35 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 20:40:35 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:40:35 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 20:40:35 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:40:35 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:40:35 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:40:35 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:40:35 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 20:40:35 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:40:35 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 20:40:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:40:48 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:40:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:40:54 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:40:54 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:40:54 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:40:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:40:54 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:40:54 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:40:54 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:40:54 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:40:54 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:40:54 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:40:54 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:40:54 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:40:54 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:40:54 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:40:54 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:40:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:40:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:41:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:41:52 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:41:52 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:41:52 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:41:52 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:41:52 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:41:52 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:41:52 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:41:52 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:41:52 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:41:52 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:41:52 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:41:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:42:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:43:27 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:43:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:43:35 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:43:35 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:43:35 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:43:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:43:35 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:43:35 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:43:35 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:43:35 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:43:35 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:43:35 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:43:35 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:43:35 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:43:35 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:43:35 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:43:35 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:43:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:43:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:44:23 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:44:23 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:44:23 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:44:23 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:44:23 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:44:23 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:44:23 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:44:23 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:44:23 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:44:23 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:44:23 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:44:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:44:37 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:44:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:44:43 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:44:43 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:44:43 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:44:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:44:44 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:44:44 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:44:44 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:44:44 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:44:44 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:44:44 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:44:44 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:44:44 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:44:44 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:44:44 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:44:44 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:44:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:44:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:45:14 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:45:14 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:45:14 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:45:14 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:45:14 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:45:14 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:45:14 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:45:14 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:45:14 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:45:14 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:45:14 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:45:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:45:31 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:45:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:45:38 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:45:38 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:45:38 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:45:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:45:38 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:45:38 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:45:38 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:45:38 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:45:38 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:45:38 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:45:38 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:45:38 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:45:38 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:45:38 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:45:38 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:45:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:45:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:45:53 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:45:53 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:45:53 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:45:53 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:45:53 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:45:53 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:45:53 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:45:53 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:45:53 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:45:53 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:45:53 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:45:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:46:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:47:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:48:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:49:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:50:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:51:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:52:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:53:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:54:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:56:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:57:25 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:57:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:57:32 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:57:32 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:57:32 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:57:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:57:32 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:57:32 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:57:32 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:57:32 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:57:32 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:57:32 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:57:32 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:57:32 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:57:32 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:57:32 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:57:32 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:57:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:58:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:59:30 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:59:30 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:59:30 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:59:30 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:59:30 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:59:30 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:59:30 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:59:30 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:59:30 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:59:30 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:59:30 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 20:59:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:59:51 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 20:59:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 20:59:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:59:58 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:59:58 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:59:58 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 20:59:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 20:59:58 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 20:59:58 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 20:59:58 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 20:59:58 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 20:59:58 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:59:58 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 20:59:58 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:59:58 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 20:59:58 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 20:59:58 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 20:59:58 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:00:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:02:21 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:02:21 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:02:21 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:02:21 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:02:21 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:02:21 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:02:21 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:02:21 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:02:21 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:02:21 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:02:21 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:02:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:02:37 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 21:02:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:02:45 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:02:45 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:02:45 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 21:02:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:02:45 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:02:45 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:02:45 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:02:45 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:02:45 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:02:45 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:02:45 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:02:45 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:02:45 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:02:45 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:02:45 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:02:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:02:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:03:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:04:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:05:13 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:05:13 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:05:13 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:05:13 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:05:13 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:05:13 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:05:13 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:05:13 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:05:13 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:05:13 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:05:13 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:05:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:05:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:05:39 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:05:39 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:05:39 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:05:39 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:05:39 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:05:39 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:05:39 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:05:39 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:05:39 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:05:39 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:05:39 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:05:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:06:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:06:30 --> Logout - Usuario: especialista1, ID: 6
DEBUG - 2025-10-05 21:06:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:08:51 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 21:08:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:08:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:09:15 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:09:15 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:09:15 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 21:09:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:09:15 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:09:15 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:09:15 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:09:15 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:09:15 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:09:15 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:09:15 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:09:15 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:09:15 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:09:15 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:09:15 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:09:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:09:16 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:09:16 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:09:16 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:09:16 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:09:16 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:09:16 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:09:16 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:09:16 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:09:16 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:09:16 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:09:16 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:09:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:09:45 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 21:09:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:09:53 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:09:53 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:09:53 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 21:09:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:09:53 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:09:53 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:09:53 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:09:53 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:09:53 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:09:53 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:09:53 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:09:53 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:09:53 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:09:53 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:09:53 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:09:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:09:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:10:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:11:05 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:11:05 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:11:05 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 21:11:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:11:05 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:11:05 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:11:05 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:11:05 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:11:05 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:11:05 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:11:05 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:11:05 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:11:05 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:11:05 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:11:05 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:11:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:11:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:12:47 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:12:47 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:12:47 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:12:47 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:12:47 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:12:47 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:12:47 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:12:47 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:12:47 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:12:47 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:12:47 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:12:57 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:12:57 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:12:57 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 21:12:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:12:57 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:12:57 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:12:57 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:12:57 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:12:57 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:12:57 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:12:57 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:12:57 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:12:57 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:12:57 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:12:57 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:12:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:12:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:13:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:14:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:14:21 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:14:21 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:14:21 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:14:21 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:14:21 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:14:21 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:14:21 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:14:21 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:14:21 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:14:21 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:14:21 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:14:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:14:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:14:34 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:14:34 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:14:34 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:14:34 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:14:34 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:14:34 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:14:34 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:14:34 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:14:34 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:14:34 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:14:34 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:14:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:15:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:16:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:17:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:18:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:19:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:20:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:21:02 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:21:02 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:21:02 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:21:02 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:21:02 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:21:02 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:21:02 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:21:02 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:21:02 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:21:02 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:21:02 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:21:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:21:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:21:27 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:21:27 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:21:27 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:21:27 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:21:27 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:21:27 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:21:27 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:21:27 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:21:27 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:21:27 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:21:27 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:21:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:22:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:22:47 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:22:47 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:22:47 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:22:47 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:22:47 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:22:47 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:22:47 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:22:47 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:22:47 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:22:47 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:22:47 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:22:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:23:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:24:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:25:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:26:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:27:52 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 21:27:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:55 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:56 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:27:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:27:59 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:27:59 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:27:59 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 21:27:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:27:59 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:27:59 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:27:59 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:27:59 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:27:59 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:27:59 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:27:59 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:27:59 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:27:59 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:27:59 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:27:59 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:28:00 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:28:21 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:28:21 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:28:21 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 21:28:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:28:22 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:28:22 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:28:22 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:28:22 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:28:22 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:28:22 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:28:22 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:28:22 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:28:22 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:28:22 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:28:22 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:28:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:28:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:29:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:30:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:31:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:33:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:37:18 --> Verificando acceso médico - ate_codigo: 2, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:37:18 --> Formulario encontrado: {"id":"3","ate_codigo":"2","usu_id":"8","seccion":"ES","fecha":"2025-10-05 18:37:58","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:32:18","motivo_habilitacion":"ASDASD"}
INFO - 2025-10-05 21:37:18 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:37:18 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"51","ate_codigo":"2","tan_codigo":"1","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"52","ate_codigo":"2","tan_codigo":"2","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"53","ate_codigo":"2","tan_codigo":"3","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"54","ate_codigo":"2","tan_codigo":"4","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"55","ate_codigo":"2","tan_codigo":"5","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"56","ate_codigo":"2","tan_codigo":"6","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"57","ate_codigo":"2","tan_codigo":"7","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"58","ate_codigo":"2","tan_codigo":"8","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"59","ate_codigo":"2","tan_codigo":"9","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"},{"ap_codigo":"60","ate_codigo":"2","tan_codigo":"10","ap_descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","ap_no_aplica":"0"}]
INFO - 2025-10-05 21:37:18 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:37:18 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"15","ate_codigo":"2","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:37:18 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:37:18 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionF":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionH":{"zonas":["1","4","7","10","13","2","5","8","11","14","3","6","9","12","15"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionI":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"},"seccionL":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"123"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A75.9"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I50.9"}},"seccionM":{"diagnostico1":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"I21.19"},"diagnostico2":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A15.7"},"diagnostico3":{"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD","cie":"A18.3"}},"seccionN":{"plan_general":"","tratamientos":[{"trat_id":"8","medicamento":"PRUEBAS NO APLICA ESPECIALIDAD","via":"PRUEBAS NO APLICA ESPECIALIDAD","dosis":"zvDAD","posologia":"asd","dias":"","administrado":1},{"trat_id":"9","medicamento":"OBSERVACION77s","via":"CVVV88","dosis":"CC99","posologia":"PRUEBAS NO APLICA ESPECIALIDAD","dias":"","administrado":1},{"trat_id":"10","medicamento":"ENVIO ENFEMREIA 29","via":"envio a enfermeria","dosis":"60 mg","posologia":"SC c\/12h","dias":"","administrado":1},{"trat_id":"11","medicamento":"Atorvastatina","via":"PRUEBAS SQLSERVER","dosis":"80 mg VO","posologia":"cada 8 horas","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"NO APLICA","egr_observaciones":"NO APLICA","egr_dias_reposo":"22","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:37:18 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":false,"antecedentes":["1","2","3","4","5","6","7","8","9","10"],"descripcion":"PRUEBAS NO APLICA ESPECIALIDAD"}
INFO - 2025-10-05 21:37:18 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:37:18 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":false,"tipos":["1","3","5","7","9","11","13","15","2","4","6","8","10","12","14","16"],"observaciones":"PRUEBAS NO APLICA ESPECIALIDAD"}
DEBUG - 2025-10-05 21:37:20 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:37:41 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 21:37:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:37:49 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:37:49 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:37:49 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 21:37:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:37:49 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:37:49 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:37:49 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:37:49 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:37:49 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:37:49 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:37:49 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:37:49 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:37:49 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:37:49 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:37:49 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:37:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:37:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:38:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:39:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:42 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:40:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:41:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:42:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:42:36 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:42:36 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:42:36 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:42:36 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:42:36 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:42:36 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:42:36 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:42:36 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:42:36 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:42:36 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:42:36 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:42:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:43:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:43:43 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 21:43:43 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 21:43:43 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 21:43:43 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 21:43:43 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:43:43 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 21:43:43 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:43:43 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 21:43:43 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 21:43:43 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 21:43:43 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 21:43:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:04 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:06 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:06 --> Logout - Usuario: especialista1, ID: 6
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:11 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 21:44:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:13 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:33 --> Logout - Usuario: especialista1, ID: 6
DEBUG - 2025-10-05 21:44:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:37 --> Login exitoso - Usuario: admision1, ID: 2, Rol: ADMISIONISTA
DEBUG - 2025-10-05 21:44:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:43 --> Logout - Usuario: admision1, ID: 2
DEBUG - 2025-10-05 21:44:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:48 --> Login exitoso - Usuario: enfermeria1, ID: 3, Rol: ENFERMERIA
DEBUG - 2025-10-05 21:44:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:51 --> Logout - Usuario: enfermeria1, ID: 3
DEBUG - 2025-10-05 21:44:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:58 --> Login exitoso - Usuario: medico1, ID: 4, Rol: MEDICO_TRIAJE
DEBUG - 2025-10-05 21:44:58 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:44:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:44:59 --> LISTA MÉDICOS: 0 pacientes encontrados (excluyendo asignados, observación y procesos parciales)
DEBUG - 2025-10-05 21:44:59 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:45:01 --> Logout - Usuario: medico1, ID: 4
DEBUG - 2025-10-05 21:45:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 21:45:08 --> Login exitoso - Usuario: administrador, ID: 1, Rol: ADMINISTRADOR
DEBUG - 2025-10-05 21:45:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:14 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:45:57 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 21:46:05 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:20:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:21:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:21:49 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:21:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:21:51 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:22:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:22:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:22:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:22:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:22:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:22:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:22:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:24:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:24:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:56:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:56:50 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:56:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:56:54 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 22:57:36 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 22:57:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:40 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:41 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 22:57:43 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 22:57:43 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 22:57:43 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 22:57:43 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 22:57:43 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 22:57:43 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 22:57:43 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 22:57:43 --> 🔍 DEBUG - seccionE BD RAW: [{"ap_codigo":"68","ate_codigo":"5","tan_codigo":null,"ap_descripcion":null,"ap_no_aplica":"1"}]
INFO - 2025-10-05 22:57:43 --> 🔍 DEBUG - seccionE PROCESADA: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 22:57:43 --> 🔍 DEBUG - seccionJ BD RAW: {"emb_codigo":"23","ate_codigo":"5","emb_no_aplica":"1","emb_numero_gestas":null,"emb_numero_partos":null,"emb_numero_abortos":null,"emb_numero_cesareas":null,"emb_fum":null,"emb_afu":null,"emb_semanas_gestacion":null,"emb_movimiento_fetal":null,"emb_frecuencia_cardiaca_fetal":null,"emb_ruptura_menbranas":null,"emb_tiempo":null,"emb_presentacion":null,"emb_sangrado_vaginal":null,"emb_contracciones":null,"emb_dilatacion":null,"emb_borramiento":null,"emb_plano":null,"emb_pelvis_viable":null,"emb_score_mama":null,"emb_observaciones":null}
INFO - 2025-10-05 22:57:43 --> 🔍 DEBUG - seccionJ PROCESADA: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 22:57:43 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionE":{"no_aplica":true,"antecedentes":[],"descripcion":""},"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionJ":{"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""},"seccionK":{"no_aplica":true,"tipos":[],"observaciones":""},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 22:57:43 --> 🔍 DEBUG Observación - seccionE: {"no_aplica":true,"antecedentes":[],"descripcion":""}
INFO - 2025-10-05 22:57:43 --> 🔍 DEBUG Observación - seccionJ: {"no_aplica":true,"gestas":"","partos":"","abortos":"","cesareas":"","fum":"","semanas_gestacion":"","movimiento_fetal":"","fcf":"","ruptura_membranas":"","tiempo_ruptura":"","afu":"","presentacion":"","sangrado_vaginal":"","contracciones":"","dilatacion":"","borramiento":"","plano":"","pelvis_viable":"","score_mama":"","observaciones":""}
INFO - 2025-10-05 22:57:43 --> 🔍 DEBUG Observación - seccionK: {"no_aplica":true,"tipos":[],"observaciones":""}
DEBUG - 2025-10-05 22:57:44 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:45 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:57:48 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:58:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:25 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:26 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:28 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 22:59:33 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 22:59:33 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 22:59:33 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 22:59:33 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 22:59:33 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 22:59:33 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 22:59:33 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 22:59:33 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 22:59:33 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 22:59:33 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 22:59:33 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 22:59:34 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:52 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 22:59:53 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:10 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:11 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:27 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:29 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:30 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:33 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 23:00:35 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 23:00:35 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 23:00:35 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 23:00:35 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 23:00:35 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 23:00:35 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 23:00:35 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 23:00:35 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 23:00:35 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 23:00:35 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 23:00:35 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 23:00:35 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 23:00:35 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 23:00:35 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 23:00:35 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 23:00:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:36 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:37 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:38 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:00:39 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:12 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 23:01:15 --> Login exitoso - Usuario: especialista1, ID: 6, Rol: MEDICO_ESPECIALISTA
DEBUG - 2025-10-05 23:01:15 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:16 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:17 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:18 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:19 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 23:01:21 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 23:01:21 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 23:01:21 --> Modificación habilitada por admin detectada
DEBUG - 2025-10-05 23:01:21 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 23:01:21 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 23:01:21 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 23:01:21 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 23:01:21 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 23:01:21 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 23:01:21 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 23:01:21 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 23:01:21 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 23:01:21 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 23:01:21 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 23:01:21 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 23:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:22 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:23 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:01:24 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:01 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:07 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 23:02:07 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 23:02:07 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 23:02:07 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 23:02:07 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 23:02:07 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 23:02:07 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 23:02:07 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 23:02:07 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 23:02:07 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 23:02:07 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 23:02:07 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 23:02:08 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:09 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:46 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:02:47 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:02 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
INFO - 2025-10-05 23:03:02 --> Verificando acceso médico - ate_codigo: 5, usu_id: 6, seccion: ES
INFO - 2025-10-05 23:03:02 --> Formulario encontrado: {"id":"5","ate_codigo":"5","usu_id":"8","seccion":"ES","fecha":"2025-10-05 19:43:16","modificaciones_permitidas":"3","modificaciones_usadas":"0","habilitado_por_admin":"1","admin_que_habilito":"1","fecha_habilitacion":"2025-10-05 19:43:36","motivo_habilitacion":"asda"}
INFO - 2025-10-05 23:03:02 --> Modificación habilitada por admin detectada
INFO - 2025-10-05 23:03:02 --> 🔍 DEBUG - seccionE BD RAW: []
INFO - 2025-10-05 23:03:02 --> ⚠️ DEBUG - seccionE VACÍA en BD
INFO - 2025-10-05 23:03:02 --> 🔍 DEBUG - seccionJ BD RAW: null
INFO - 2025-10-05 23:03:02 --> ⚠️ DEBUG - seccionJ VACÍA en BD
INFO - 2025-10-05 23:03:02 --> 🔍 DEBUG Observación - datosObservacionGuardados: {"seccionF":{"descripcion":"prubas no aplica"},"seccionH":{"zonas":["7","5","11","3","15"],"descripcion":"prubas no aplica"},"seccionI":{"descripcion":"prubas no aplica"},"seccionL":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.1"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"A75.9"}},"seccionM":{"diagnostico1":{"descripcion":"prubas no aplica","cie":"I21.19"},"diagnostico2":{"descripcion":"prubas no aplica","cie":"O44.0"}},"seccionN":{"plan_general":"prubas no aplica","tratamientos":[{"trat_id":"27","medicamento":"OBSERVACION","via":"por c\u00e1nula nasal","dosis":"3 L\/min","posologia":"en este momento","dias":"","administrado":1},{"trat_id":"28","medicamento":"ENVIO MEDICO 29","via":"PRUEBAS","dosis":" 100 mg\/d\u00eda","posologia":"XV","dias":"","administrado":1}]},"seccionO":{"egr_establecimiento":"pruebas no aplica","egr_observaciones":"pruebas no aplica","egr_dias_reposo":"5","egr_observacion_emergencia":"0","estados_egreso":["1","2","3","4"],"modalidades_egreso":["1","2","3"],"tipos_egreso":["1","2","3","4"]}}
INFO - 2025-10-05 23:03:02 --> 🔍 DEBUG Observación - seccionE: "NO EXISTE"
INFO - 2025-10-05 23:03:02 --> 🔍 DEBUG Observación - seccionJ: "NO EXISTE"
INFO - 2025-10-05 23:03:02 --> 🔍 DEBUG Observación - seccionK: "NO EXISTE"
DEBUG - 2025-10-05 23:03:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:03 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:31 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
DEBUG - 2025-10-05 23:03:32 --> Session: Class initialized using 'CodeIgniter\Session\Handlers\FileHandler' driver.
